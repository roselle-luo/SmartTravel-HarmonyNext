import { ActivityPage } from './activity/ActivityPage';
import { HomePage } from './home/HomePage';
import { ProfilePage } from './profile/ProfilePage';
import { display } from '@kit.ArkUI';

@Entry
@Component
struct Index {
  @State selected: number = 0;

  aboutToAppear() {
    this.updateBarPosition(); // é¦–æ¬¡åŠ è½½æ—¶æ›´æ–°å¯¼èˆªæ ä½ç½®
  }

  // ç›‘å¬å±å¹•å°ºå¯¸å˜åŒ–
  onConfigurationUpdate(config: Configuration) {
    this.updateBarPosition();
  }

  // æ ¹æ®å±å¹•å®½åº¦æ›´æ–°å¯¼èˆªæ ä½ç½®
  private updateBarPosition() {
    const deviceWidth = display.getDefaultDisplaySync().width
    console.debug(deviceWidth?.toString())
    // æ£€æŸ¥ deviceWidth æ˜¯å¦ä¸ºæœ‰æ•ˆçš„æ•°å­—
    if (deviceWidth !== undefined && deviceWidth !== null && typeof deviceWidth === 'number') {
      console.log(deviceWidth.toString())
    } else {
      // å¦‚æœ deviceWidth ä¸å­˜åœ¨æˆ–ä¸æ˜¯æ•°å­—ï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ªé»˜è®¤å€¼
      // æˆ–è€…æ ¹æ®ä½ çš„åº”ç”¨é€»è¾‘è¿›è¡Œé”™è¯¯å¤„ç†ï¼Œä¾‹å¦‚ï¼š
      console.error("AppStorage 'width' is undefined or not a number, defaulting to BarPosition.End.");
    }
  }

  build() {
    Column() {
      Tabs({ index: this.selected, barPosition: BarPosition.End }) { // ä½¿ç”¨åŠ¨æ€çš„ barPosition
        TabContent() {
          HomePage()
        }.tabBar(this.TabBuilder('é¦–é¡µ', 'ğŸ ', 0))
        TabContent() {
          ActivityPage()
        }.tabBar(this.TabBuilder('æ´»åŠ¨', 'ğŸ”', 1))
        TabContent() {
          ProfilePage()
        }.tabBar(this.TabBuilder('ä¸»é¡µ', 'ğŸ‘¤', 2))
      }
      .width('100%')
      .height('100%')
      .barMode(BarMode.Fixed) // å›ºå®šTabæ æ¨¡å¼
      // å½“å¯¼èˆªæ åœ¨å·¦ä¾§æ—¶ï¼Œè°ƒæ•´ barWidth å’Œ barHeight
      .barHeight(60)
      .backgroundColor(Color.White)
      .onChange((index: number) => {
        this.selected = index;
      })
    }
    .width('100%')
    .height('100%')
  }

  // è‡ªå®šä¹‰ TabBar å¸ƒå±€
  @Builder TabBuilder(title: string, icon: string, index: number) {
    Column() {
      Text(icon) // å›¾æ ‡ (è¿™é‡Œä½¿ç”¨Emojiæ¨¡æ‹Ÿ)
        .fontSize(24)
        .fontColor(this.selected === index ? '#3b82f6' : '#64748b') // é€‰ä¸­è“è‰²ï¼Œæœªé€‰ä¸­ç°è‰²
      Text(title) // æ ‡é¢˜
        .fontSize(12)
        .fontColor(this.selected === index ? '#3b82f6' : '#64748b')
        .fontWeight(this.selected === index ? FontWeight.Medium : FontWeight.Normal)
    }
    .width('100%')
    .height('100%')
    .justifyContent(FlexAlign.Center)
  }
}